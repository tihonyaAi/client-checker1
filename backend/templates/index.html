<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <title>Проверка ников</title>
    <style>
        .history-item.green { color: green; }
        .history-item.red { color: red; }
        #message { margin-bottom: 10px; color: blue; }
    </style>
</head>
<body>
    <h1>Проверка ников</h1>

    <div id="message"></div>

    <input id="nickname-input" type="text" placeholder="Введите ник" />
    <button id="check-btn">Проверить</button>

    <ul id="history-list"></ul>

    <script>
        const input = document.getElementById("nickname-input");
        const btn = document.getElementById("check-btn");
        const message = document.getElementById("message");
        const historyList = document.getElementById("history-list");

        // Токен надо получить при логине (у тебя он, наверное, где-то сохраняется)
        let token = localStorage.getItem("token"); // или откуда у тебя

        // Функция проверки ников
        async function checkNicknames() {
            const nick = input.value.trim();
            if (!nick) return;

            try {
                const response = await fetch("/check", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "Authorization": "Bearer " + token
                    },
                    body: JSON.stringify({ nicknames: [nick] })
                });
                if (!response.ok) throw new Error("Ошибка проверки");

                const data = await response.json();
                message.textContent = ""; // очистить сообщение

                // Обновим историю
                await loadHistory();

                input.value = "";
            } catch (e) {
                message.textContent = "Ошибка: " + e.message;
            }
        }

        // Загрузка истории
        async function loadHistory() {
            try {
                const response = await fetch("/history", {
                    headers: { "Authorization": "Bearer " + token }
                });
                if (!response.ok) throw new Error("Ошибка загрузки истории");
                const data = await response.json();

                historyList.innerHTML = "";
                data.forEach(item => {
                    const li = document.createElement("li");
                    li.textContent = item;

                    if (item.includes("Не найдено")) {
                        li.classList.add("green");
                    } else if (item.includes("Ник занят")) {
                        li.classList.add("red");
                    }
                    historyList.appendChild(li);
                });
            } catch (e) {
                message.textContent = "Ошибка: " + e.message;
            }
        }

        // Обработка клика на кнопку
        btn.addEventListener("click", () => {
            checkNicknames();
        });

        // Обработка нажатия Enter в input
        input.addEventListener("keydown", (event) => {
            if (event.key === "Enter") {
                event.preventDefault(); // чтобы не было сабмита формы
                checkNicknames();
            }
        });

        // Загрузка истории при загрузке страницы
        window.onload = loadHistory;
    </script>
</body>
</html>
